<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>StardewPote P2</title>
    <style>
        body {
            margin: 0;
            font-size: 15px;
            color: #32373F;
            background-color: #d3f8d8; /* Fond vert pastel */
            font-family: 'Avenir Next', 'Avenir', 'Arial', sans-serif;
            padding: 20px;
            position: relative; /* Nécessaire pour positionner l'image */
            min-height: 100vh;
        }

        .character-display img {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            position: absolute;
            cursor: pointer; /* Le curseur devient un pointeur quand on survole l'image */
        }
    </style>
</head>
<body>
    <div class="exported-note">
        <div class="exported-note-title">StardewPote P2</div>
        <p>Bienvenue sur la deuxième partie de StardewPote !</p>

        <div class="character-display" id="character-display">
            <!-- Les images des personnages seront injectées ici -->
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
    <script>
        // Remplace ceci par tes propres données de connexion Supabase
        const supabase = createClient('https://jubfwjzmtosbtbgsnbka.supabase.co', 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imp1YmZ3anptdG9zYnRiZ3NuYmthIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzc3NDYzMDUsImV4cCI6MjA1MzMyMjMwNX0.s1rnGejG9TA9S7yRALZ-3AQucC0J9IaZ6sKlm3M_qlE');

        const characterDisplay = document.getElementById('character-display');

        // Fonction pour récupérer les personnages depuis Supabase
        async function fetchCharacters() {
            const { data, error } = await supabase
                .from('characters')
                .select('id, x, y');

            if (error) {
                console.error('Erreur en récupérant les personnages : ', error);
                return;
            }

            data.forEach(character => {
                // Créer l'élément image pour chaque personnage
                const imgElement = document.createElement('img');
                imgElement.src = `https://example.com/images/${character.id}.png`; // Remplace par l'URL correcte de l'image
                imgElement.id = `character-image-${character.id}`;
                imgElement.alt = `Personnage ${character.id}`;
                imgElement.style.left = `${character.x}px`;
                imgElement.style.top = `${character.y}px`;
                characterDisplay.appendChild(imgElement);

                // Fonction pour déplacer l'image
                let offsetX, offsetY;
                imgElement.addEventListener('mousedown', (event) => {
                    offsetX = event.clientX - imgElement.getBoundingClientRect().left;
                    offsetY = event.clientY - imgElement.getBoundingClientRect().top;

                    const onMouseMove = (event) => {
                        const newX = event.clientX - offsetX;
                        const newY = event.clientY - offsetY;
                        imgElement.style.left = `${newX}px`;
                        imgElement.style.top = `${newY}px`;

                        // Mettre à jour les coordonnées dans Supabase
                        updatePositionInSupabase(character.id, newX, newY);
                    };

                    const onMouseUp = () => {
                        window.removeEventListener('mousemove', onMouseMove);
                        window.removeEventListener('mouseup', onMouseUp);
                    };

                    window.addEventListener('mousemove', onMouseMove);
                    window.addEventListener('mouseup', onMouseUp);
                });
            });
        }

        // Fonction pour mettre à jour les coordonnées dans Supabase
        async function updatePositionInSupabase(id, x, y) {
            const { error } = await supabase
                .from('characters')
                .upsert([
                    { id: id, x: x, y: y }
                ]);
            if (error) console.error("Erreur de mise à jour dans Supabase :", error);
        }

        // Appeler la fonction pour récupérer les personnages
        fetchCharacters();
    </script>
</body>
</html>
